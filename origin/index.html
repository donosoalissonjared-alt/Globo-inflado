<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Battle Royale Demo</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls, player, bullets = [];

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(10, 10, 10);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0x404040));

  const groundGeo = new THREE.PlaneGeometry(500, 500);
  const groundMat = new THREE.MeshPhongMaterial({ color: 0x228B22 });
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI / 2;
  scene.add(ground);

  const boxGeo = new THREE.BoxGeometry(2, 2, 2);
  const boxMat = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
  for (let i = 0; i < 50; i++) {
    const box = new THREE.Mesh(boxGeo, boxMat);
    box.position.set((Math.random() - 0.5) * 400, 1, (Math.random() - 0.5) * 400);
    scene.add(box);
  }

  player = new THREE.Object3D();
  camera.position.set(0, 2, 5);
  player.add(camera);
  scene.add(player);

  controls = new THREE.PointerLockControls(camera, document.body);
  document.body.addEventListener('click', () => controls.lock());

  const move = { f: 0, b: 0, l: 0, r: 0 };
  document.addEventListener('keydown', e => {
    if (e.code === 'KeyW') move.f = 1;
    if (e.code === 'KeyS') move.b = 1;
    if (e.code === 'KeyA') move.l = 1;
    if (e.code === 'KeyD') move.r = 1;
    if (e.code === 'Space') shoot();
  });
  document.addEventListener('keyup', e => {
    if (e.code === 'KeyW') move.f = 0;
    if (e.code === 'KeyS') move.b = 0;
    if (e.code === 'KeyA') move.l = 0;
    if (e.code === 'KeyD') move.r = 0;
  });

  function updateMovement() {
    const speed = 0.3;
    const dir = new THREE.Vector3();
    if (move.f) dir.z -= 1;
    if (move.b) dir.z += 1;
    if (move.l) dir.x -= 1;
    if (move.r) dir.x += 1;
    dir.normalize();
    dir.applyEuler(camera.rotation);
    player.position.addScaledVector(dir, speed);
  }

  function shoot() {
    const bulletGeo = new THREE.SphereGeometry(0.1, 8, 8);
    const bulletMat = new THREE.MeshBasicMaterial({ color: 0xff0000 });
    const bullet = new THREE.Mesh(bulletGeo, bulletMat);
    bullet.position.copy(camera.position);
    bullet.userData.velocity = new THREE.Vector3(0, 0, -1).applyEuler(camera.rotation).multiplyScalar(2);
    scene.add(bullet);
    bullets.push(bullet);
  }

  function loop() {
    if (controls.isLocked) updateMovement();
    bullets.forEach(b => b.position.add(b.userData.velocity));
    renderer.render(scene, camera);
    requestAnimationFrame(loop);
  }

  loop();
}

function animate() {}
</script>
</body>
</html>
